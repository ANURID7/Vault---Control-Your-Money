{% extends "base.html" %}

{% block content %}

<style>
    /* ===== Financial Theme Variables ===== */
    :root {
        --primary: #0F3D3E;
        --primary-light: #1A5A5B;
        --primary-dark: #0A2D2E;
        --accent: #14B8A6;
        --accent-soft: rgba(20, 184, 166, 0.12);
        --accent-gradient: linear-gradient(145deg, #14B8A6, #0D9488);
        --success: #10B981;
        --success-soft: rgba(16, 185, 129, 0.12);
        --warning: #F59E0B;
        --warning-soft: rgba(245, 158, 11, 0.12);
        --danger: #EF4444;
        --danger-soft: rgba(239, 68, 68, 0.12);
        --bg-main: #EEF2F7;
        --bg-card: rgba(255, 255, 255, 0.95);
        --text-primary: #0F172A;
        --text-secondary: #475569;
        --text-tertiary: #64748B;
        --border-light: rgba(203, 213, 225, 0.4);
        --shadow-card: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        --shadow-hover: 0 30px 60px -12px rgba(20, 184, 166, 0.25);
        --chat-user: #0F3D3E;
        --chat-ai: #FFFFFF;
        --chat-ai-border: rgba(20, 184, 166, 0.2);
    }

    /* ===== Chat Layout ===== */
    .chat-wrapper {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 140px);
        position: relative;
        margin-bottom: 20px;
    }

    /* ===== Header ===== */
    .chat-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        animation: slideDown 0.5s ease;
    }

    .chat-title {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chat-title span {
        font-family: 'Sora', sans-serif;
        font-weight: 800;
        font-size: 24px;
        background: linear-gradient(145deg, var(--primary), var(--primary-light));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .chat-title i {
        width: 10px;
        height: 10px;
        background: var(--accent);
        border-radius: 3px;
        display: inline-block;
    }

    .chat-status {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: var(--accent-soft);
        border-radius: 30px;
        font-size: 13px;
        font-weight: 600;
        color: var(--accent);
        border: 1px solid rgba(20, 184, 166, 0.2);
    }

    .status-dot {
        width: 8px;
        height: 8px;
        background: var(--accent);
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* ===== Quick Stats Bar ===== */
    .quick-stats {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        padding: 12px 16px;
        background: var(--bg-card);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border-light);
        border-radius: 30px;
        box-shadow: var(--shadow-card);
        animation: slideDown 0.5s ease 0.1s both;
    }

    .stat-pill {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
    }

    .stat-label {
        font-size: 11px;
        color: var(--text-tertiary);
        font-weight: 500;
    }

    .stat-value {
        font-size: 15px;
        font-weight: 700;
        color: var(--text-primary);
    }

    .stat-value.positive {
        color: var(--success);
    }

    .stat-value.negative {
        color: var(--danger);
    }

    /* ===== Chat Container ===== */
    .chat-container {
        flex: 1;
        background: var(--bg-card);
        backdrop-filter: blur(10px);
        border-radius: 32px;
        box-shadow: var(--shadow-card);
        border: 1px solid var(--border-light);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        animation: slideUp 0.5s ease 0.2s both;
    }

    /* ===== Messages Area ===== */
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
        background: linear-gradient(180deg, #F8FAFC, #FFFFFF);
        scroll-behavior: smooth;
    }

    /* Scrollbar styling */
    .chat-messages::-webkit-scrollbar {
        width: 4px;
    }
    .chat-messages::-webkit-scrollbar-track {
        background: transparent;
    }
    .chat-messages::-webkit-scrollbar-thumb {
        background: var(--accent-soft);
        border-radius: 20px;
    }

    /* ===== Message Bubbles ===== */
    .message {
        display: flex;
        margin-bottom: 20px;
        animation: slideUp 0.3s ease;
    }

    .message.user {
        justify-content: flex-end;
    }

    .bubble-wrapper {
        max-width: 75%;
    }

    .bubble {
        padding: 14px 18px;
        border-radius: 24px;
        font-size: 14px;
        line-height: 1.6;
        box-shadow: var(--shadow-sm);
        position: relative;
    }

    /* AI bubble */
    .bubble.ai {
        background: var(--chat-ai);
        border: 1px solid var(--chat-ai-border);
        border-bottom-left-radius: 8px;
        color: var(--text-primary);
    }

    /* User bubble */
    .bubble.user {
        background: var(--chat-user);
        border-bottom-right-radius: 8px;
        color: white;
    }

    /* Financial highlights in messages */
    .highlight {
        background: linear-gradient(145deg, rgba(20, 184, 166, 0.1), transparent);
        padding: 2px 6px;
        border-radius: 12px;
        color: var(--accent);
        font-weight: 600;
    }

    .amount {
        font-weight: 700;
        color: var(--success);
    }

    .amount.negative {
        color: var(--danger);
    }

    /* Timestamp */
    .timestamp {
        font-size: 10px;
        color: var(--text-tertiary);
        margin-top: 4px;
        margin-left: 8px;
    }

    .message.user .timestamp {
        text-align: right;
        margin-right: 8px;
    }

    /* ===== Typing Indicator ===== */
    .typing-indicator {
        display: flex;
        gap: 4px;
        padding: 16px 20px;
        background: var(--chat-ai);
        border: 1px solid var(--chat-ai-border);
        border-radius: 24px;
        border-bottom-left-radius: 8px;
        width: fit-content;
    }

    .typing-dot {
        width: 8px;
        height: 8px;
        background: var(--accent);
        border-radius: 50%;
        opacity: 0.6;
        animation: typing 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes typing {
        0%, 60%, 100% {
            transform: translateY(0);
            opacity: 0.6;
        }
        30% {
            transform: translateY(-8px);
            opacity: 1;
        }
    }

    /* ===== Quick Suggestions ===== */
    .suggestions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin: 16px 0 8px;
        padding: 0 4px;
    }

    .suggestion-chip {
        padding: 10px 18px;
        background: white;
        border: 1px solid var(--border-light);
        border-radius: 30px;
        font-size: 13px;
        font-weight: 500;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.02);
    }

    .suggestion-chip:hover {
        background: var(--accent-soft);
        border-color: var(--accent);
        color: var(--accent);
        transform: translateY(-2px);
    }

    .suggestion-chip:active {
        transform: translateY(0);
    }

    /* ===== Input Area - Redesigned ===== */
    .chat-input-area {
        padding: 20px;
        border-top: 1px solid var(--border-light);
        background: rgba(255,255,255,0.9);
        backdrop-filter: blur(10px);
    }

    .chat-input-wrapper {
        display: flex;
        align-items: center;
        background: #F8FAFC;
        border-radius: 30px;
        padding: 4px 4px 4px 20px;
        border: 1px solid var(--border-light);
        transition: all 0.2s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.02);
    }

    .chat-input-wrapper:focus-within {
        border-color: var(--accent);
        box-shadow: 0 4px 16px rgba(20, 184, 166, 0.15);
    }

    .chat-input {
        flex: 1;
        border: none;
        background: transparent;
        padding: 14px 8px 14px 0;
        font-size: 15px;
        outline: none;
        color: var(--text-primary);
        font-family: 'Inter', sans-serif;
    }

    .chat-input::placeholder {
        color: var(--text-tertiary);
        opacity: 0.6;
    }

    .send-btn {
        width: 44px;
        height: 44px;
        border-radius: 30px;
        border: none;
        background: var(--accent);
        color: white;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .send-btn:hover {
        background: var(--primary);
        transform: scale(1.05);
        box-shadow: 0 8px 18px rgba(20,184,166,0.4);
    }

    .send-btn:active {
        transform: scale(0.95);
    }

    .send-btn span {
        font-size: 20px;
        line-height: 1;
    }

    /* ===== Empty State ===== */
    .chat-empty {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-tertiary);
        background: rgba(255,255,255,0.5);
        border-radius: 40px;
        margin: 20px 0;
    }

    .chat-empty h3 {
        color: var(--primary);
        margin-bottom: 8px;
        font-size: 18px;
    }

    .chat-empty p {
        font-size: 14px;
        opacity: 0.8;
    }

    .chat-empty-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
    }

    /* ===== Animations ===== */
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ===== Responsive ===== */
    @media (max-width: 480px) {
        .bubble-wrapper {
            max-width: 85%;
        }
        
        .quick-stats {
            flex-wrap: wrap;
        }
        
        .stat-pill {
            min-width: calc(50% - 6px);
        }
        
        .chat-wrapper {
            height: calc(100vh - 170px);
        }
    }
</style>

<div class="chat-wrapper">

    <!-- Header with Status -->
    <div class="chat-header">
        <div class="chat-title">
            <span>Vault AI</span>
            <i></i>
        </div>
        <div class="chat-status">
            <span class="status-dot"></span>
            <span>Active</span>
        </div>
    </div>

    <!-- Quick Financial Stats -->
    <div class="quick-stats">
        <div class="stat-pill">
            <span class="stat-label">Monthly Spend</span>
            <span class="stat-value">‚Çπ33,250</span>
        </div>
        <div class="stat-pill">
            <span class="stat-label">Budget Left</span>
            <span class="stat-value positive">‚Çπ11,750</span>
        </div>
        <div class="stat-pill">
            <span class="stat-label">Savings</span>
            <span class="stat-value positive">+12.5%</span>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container">

        <!-- Messages -->
        <div class="chat-messages" id="chatMessages">

            <!-- Welcome Message -->
            <div class="message ai">
                <div class="bubble-wrapper">
                    <div class="bubble ai">
                        Hi Anurid! I'm Vault AI, your financial assistant. I can help you with:
                        <br><br>
                        ‚Ä¢ Budget analysis<br>
                        ‚Ä¢ Investment insights<br>
                        ‚Ä¢ Spending patterns<br>
                        ‚Ä¢ Financial goals<br>
                        ‚Ä¢ Banking queries<br>
                        ‚Ä¢ Loan information
                    </div>
                    <div class="timestamp">Just now</div>
                </div>
            </div>

            <!-- Quick Suggestions -->
            <div class="suggestions" id="suggestions">
                <span class="suggestion-chip" onclick="sendQuickMessage('Show my spending this month')">Monthly spending</span>
                <span class="suggestion-chip" onclick="sendQuickMessage('Investment advice for ‚Çπ50,000')">Investment advice</span>
                <span class="suggestion-chip" onclick="sendQuickMessage('Budget vs actual')">Budget review</span>
                <span class="suggestion-chip" onclick="sendQuickMessage('Savings tips')">Savings tips</span>
                <span class="suggestion-chip" onclick="sendQuickMessage('What is a savings account?')">Savings account</span>
                <span class="suggestion-chip" onclick="sendQuickMessage('How to apply for a loan?')">Loan enquiry</span>
            </div>

        </div>

        <!-- Input Area - Redesigned -->
        <div class="chat-input-area">
            <div class="chat-input-wrapper">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask Vault AI about your finances..." />
                <button class="send-btn" onclick="sendMessage()">
                    <span>‚Üë</span>
                </button>
            </div>
        </div>

    </div>

</div>

<script>
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const suggestions = document.getElementById('suggestions');

    // Auto-scroll to bottom
    chatMessages.scrollTop = chatMessages.scrollHeight;

    // Send message on Enter
    chatInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    function sendMessage() {
        const text = chatInput.value.trim();
        if (!text) return;

        // Add user message
        addUserMessage(text);
        
        // Clear input
        chatInput.value = '';
        
        // Hide suggestions
        if (suggestions) {
            suggestions.style.display = 'none';
        }
        
        // Show typing indicator
        showTypingIndicator();
    }

    function sendQuickMessage(text) {
        chatInput.value = text;
        sendMessage();
    }

    function addUserMessage(text) {
        const now = new Date();
        const timeString = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
        
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message user';
        messageDiv.innerHTML = `
            <div class="bubble-wrapper">
                <div class="bubble user">${text}</div>
                <div class="timestamp">${timeString}</div>
            </div>
        `;
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showTypingIndicator() {
        const typingDiv = document.createElement('div');
        typingDiv.className = 'message ai';
        typingDiv.id = 'typingIndicator';
        typingDiv.innerHTML = `
            <div class="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        `;
        
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Simulate AI response after delay
        setTimeout(() => {
            document.getElementById('typingIndicator')?.remove();
            generateAIResponse();
        }, 1500);
    }

    function generateAIResponse() {
        const lastMessage = chatMessages.querySelector('.message.user:last-child .bubble.user')?.textContent || '';
        const lowerMsg = lastMessage.toLowerCase();
        
        let response = '';
        
        // Greetings
        if (lowerMsg.match(/hello|hi|hey|good morning|good afternoon|good evening/)) {
            response = `Hello! üëã How can I assist you with your finances today? You can ask me about budgets, investments, savings, loans, or banking queries.`;
        }
        
        // Banking Basics
        else if (lowerMsg.includes('savings account') || lowerMsg.includes('saving account')) {
            response = `üè¶ <strong>Savings Account Basics</strong><br><br>
            A savings account is a deposit account that earns interest. Key features:<br><br>
            ‚Ä¢ <strong>Interest Rate:</strong> 2.5% - 4% per annum<br>
            ‚Ä¢ <strong>Minimum Balance:</strong> ‚Çπ1,000 - ‚Çπ10,000 (varies by bank)<br>
            ‚Ä¢ <strong>Liquidity:</strong> High - easy withdrawals<br>
            ‚Ä¢ <strong>Safety:</strong> Insured up to ‚Çπ5 lakhs by DICGC<br><br>
            Would you like to know about specific banks or compare accounts?`;
        }
        else if (lowerMsg.includes('current account')) {
            response = `üíº <strong>Current Account Overview</strong><br><br>
            Current accounts are designed for businesses and frequent transactions:<br><br>
            ‚Ä¢ <strong>No interest</strong> typically earned<br>
            ‚Ä¢ <strong>Overdraft facility</strong> available<br>
            ‚Ä¢ <strong>Higher transaction limits</strong><br>
            ‚Ä¢ <strong>Monthly average balance:</strong> ‚Çπ10,000 - ‚Çπ25,000<br><br>
            Ideal for business owners and professionals.`;
        }
        else if (lowerMsg.includes('fixed deposit') || lowerMsg.includes('fd')) {
            response = `üìà <strong>Fixed Deposit (FD) Guide</strong><br><br>
            FDs offer guaranteed returns with low risk:<br><br>
            ‚Ä¢ <strong>Interest Rates:</strong> 5% - 7.5% per annum<br>
            ‚Ä¢ <strong>Tenure:</strong> 7 days to 10 years<br>
            ‚Ä¢ <strong>Minimum Deposit:</strong> ‚Çπ1,000<br>
            ‚Ä¢ <strong>Tax Saving FD:</strong> 5-year lock-in under 80C<br><br>
            Senior citizens get 0.25% - 0.5% higher rates.`;
        }
        else if (lowerMsg.includes('recurring deposit') || lowerMsg.includes('rd')) {
            response = `üîÑ <strong>Recurring Deposit (RD) Explained</strong><br><br>
            RD helps build savings through monthly installments:<br><br>
            ‚Ä¢ <strong>Interest Rate:</strong> 5% - 7% per annum<br>
            ‚Ä¢ <strong>Monthly Deposit:</strong> As low as ‚Çπ100<br>
            ‚Ä¢ <strong>Tenure:</strong> 6 months to 10 years<br>
            ‚Ä¢ <strong>Maturity Amount:</strong> Lump sum with interest<br><br>
            Great for regular savers building a corpus.`;
        }
        
        // Loans
        else if (lowerMsg.includes('home loan') || lowerMsg.includes('house loan')) {
            response = `üè† <strong>Home Loan Information</strong><br><br>
            For a ‚Çπ50,000 monthly income:<br><br>
            ‚Ä¢ <strong>Eligible Amount:</strong> ~‚Çπ25-30 lakhs<br>
            ‚Ä¢ <strong>Interest Rate:</strong> 8.5% - 10% per annum<br>
            ‚Ä¢ <strong>Tenure:</strong> Up to 30 years<br>
            ‚Ä¢ <strong>EMI for ‚Çπ25 lakhs:</strong> ~‚Çπ21,000 (20 years)<br>
            ‚Ä¢ <strong>Tax Benefits:</strong> Under Section 80C and 24(b)<br><br>
            First-time buyers may get additional subsidies.`;
        }
        else if (lowerMsg.includes('personal loan')) {
            response = `üí≥ <strong>Personal Loan Guide</strong><br><br>
            Personal loans are unsecured loans for various needs:<br><br>
            ‚Ä¢ <strong>Eligible Amount:</strong> ‚Çπ50,000 - ‚Çπ15 lakhs<br>
            ‚Ä¢ <strong>Interest Rate:</strong> 10% - 24% per annum<br>
            ‚Ä¢ <strong>Tenure:</strong> 1 - 5 years<br>
            ‚Ä¢ <strong>Processing Fee:</strong> 1% - 3%<br>
            ‚Ä¢ <strong>CIBIL Score:</strong> 750+ for best rates<br><br>
            Compare offers from multiple banks before applying.`;
        }
        else if (lowerMsg.includes('car loan') || lowerMsg.includes('auto loan')) {
            response = `üöó <strong>Car Loan Overview</strong><br><br>
            For a new car purchase:<br><br>
            ‚Ä¢ <strong>Loan Amount:</strong> Up to 90% of on-road price<br>
            ‚Ä¢ <strong>Interest Rate:</strong> 8% - 12% per annum<br>
            ‚Ä¢ <strong>Tenure:</strong> Up to 7 years<br>
            ‚Ä¢ <strong>EMI for ‚Çπ5 lakhs:</strong> ~‚Çπ10,500 (5 years)<br>
            ‚Ä¢ <strong>Processing Fee:</strong> 0.5% - 2%<br><br>
            Electric vehicles may have lower rates.`;
        }
        else if (lowerMsg.includes('education loan') || lowerMsg.includes('student loan')) {
            response = `üéì <strong>Education Loan Guide</strong><br><br>
            For studies in India and abroad:<br><br>
            ‚Ä¢ <strong>Loan Amount:</strong> Up to ‚Çπ20 lakhs (India), ‚Çπ40 lakhs (abroad)<br>
            ‚Ä¢ <strong>Interest Rate:</strong> 7% - 12% per annum<br>
            ‚Ä¢ <strong>Moratorium Period:</strong> Course duration + 6-12 months<br>
            ‚Ä¢ <strong>Tax Benefits:</strong> Under Section 80E<br>
            ‚Ä¢ <strong>Collateral:</strong> Required for loans above ‚Çπ7.5 lakhs<br><br>
            Interest subsidy available for economically weaker sections.`;
        }
        
        // Credit Cards
        else if (lowerMsg.includes('credit card')) {
            response = `üí≥ <strong>Credit Card Tips</strong><br><br>
            Smart credit card usage:<br><br>
            ‚Ä¢ <strong>Pay full amount</strong> by due date to avoid interest (30-45% p.a.)<br>
            ‚Ä¢ <strong>Utilization below 30%</strong> of your limit for good credit score<br>
            ‚Ä¢ <strong>Annual fees:</strong> ‚Çπ500 - ‚Çπ5,000, often waived on spending<br>
            ‚Ä¢ <strong>Rewards:</strong> 1% - 5% cashback or points<br>
            ‚Ä¢ <strong>Interest-free period:</strong> Up to 50 days<br><br>
            Would you like recommendations for your spending pattern?`;
        }
        else if (lowerMsg.includes('debit card')) {
            response = `üí≥ <strong>Debit Card Information</strong><br><br>
            Debit cards draw directly from your account:<br><br>
            ‚Ä¢ <strong>Daily withdrawal limit:</strong> ‚Çπ20,000 - ‚Çπ50,000<br>
            ‚Ä¢ <strong>POS limit:</strong> ‚Çπ50,000 - ‚Çπ1,00,000<br>
            ‚Ä¢ <strong>International usage:</strong> May require activation<br>
            ‚Ä¢ <strong>Fees:</strong> Usually free with account<br>
            ‚Ä¢ <strong>Contactless:</strong> Tap & pay for transactions under ‚Çπ5,000<br><br>
            Report lost cards immediately to block them.`;
        }
        
        // IFSC/Account queries
        else if (lowerMsg.includes('ifsc code')) {
            response = `üî¢ <strong>IFSC Code Explained</strong><br><br>
            IFSC (Indian Financial System Code) is an 11-digit alphanumeric code:<br><br>
            ‚Ä¢ <strong>First 4 characters:</strong> Bank name (e.g., SBIN for SBI)<br>
            ‚Ä¢ <strong>5th character:</strong> Always 0<br>
            ‚Ä¢ <strong>Last 6 characters:</strong> Branch code<br>
            ‚Ä¢ <strong>Use:</strong> For NEFT, RTGS, and IMPS transfers<br><br>
            Example: SBIN0012345 (SBI, specific branch)<br><br>
            You can find IFSC on your cheque book or bank's website.`;
        }
        else if (lowerMsg.includes('account number') || lowerMsg.includes('account format')) {
            response = `üî¢ <strong>Bank Account Numbers</strong><br><br>
            Account number formats vary by bank:<br><br>
            ‚Ä¢ <strong>SBI:</strong> 11 digits (starting with branch code)<br>
            ‚Ä¢ <strong>HDFC:</strong> 14 digits<br>
            ‚Ä¢ <strong>ICICI:</strong> 12-14 digits<br>
            ‚Ä¢ <strong>Axis:</strong> 15 digits<br>
            ‚Ä¢ <strong>PNB:</strong> 11-16 digits<br><br>
            Never share your account number and OTP with anyone.`;
        }
        
        // Cheque related
        else if (lowerMsg.includes('cheque') || lowerMsg.includes('check')) {
            response = `üìù <strong>Cheque Writing Guide</strong><br><br>
            Important elements of a cheque:<br><br>
            ‚Ä¢ <strong>Date:</strong> Always write current date<br>
            ‚Ä¢ <strong>Payee:</strong> Write full name clearly<br>
            ‚Ä¢ <strong>Amount in words:</strong> Match with figures<br>
            ‚Ä¢ <strong>Crossing:</strong> Add "A/C Payee" for safety<br>
            ‚Ä¢ <strong>Signature:</strong> Must match bank records<br><br>
            Cheques are valid for 3 months from issue date.`;
        }
        else if (lowerMsg.includes('cheque bounce')) {
            response = `‚ö†Ô∏è <strong>Cheque Bounce Information</strong><br><br>
            Reasons for cheque bounce:<br><br>
            ‚Ä¢ <strong>Insufficient funds</strong> in account<br>
            ‚Ä¢ <strong>Signature mismatch</strong><br>
            ‚Ä¢ <strong>Alterations</strong> without counter-signature<br>
            ‚Ä¢ <strong>Post-dated cheque</strong> presented early<br>
            ‚Ä¢ <strong>Account closed</strong> or frozen<br><br>
            Consequences: Bank penalty (‚Çπ100-500) + legal action under Section 138.`;
        }
        
        // UPI & Digital Payments
        else if (lowerMsg.includes('upi')) {
            response = `üì± <strong>UPI (Unified Payments Interface)</strong><br><br>
            UPI is India's instant payment system:<br><br>
            ‚Ä¢ <strong>Apps:</strong> Google Pay, PhonePe, Paytm, BHIM<br>
            ‚Ä¢ <strong>Limit:</strong> ‚Çπ1,00,000 per transaction<br>
            ‚Ä¢ <strong>24x7:</strong> Available all days<br>
            ‚Ä¢ <strong>Free:</strong> No charges for transactions<br>
            ‚Ä¢ <strong>Virtual ID:</strong> yourname@bank<br><br>
            Fast, secure, and convenient for daily payments.`;
        }
        else if (lowerMsg.includes('net banking')) {
            response = `üíª <strong>Net Banking Overview</strong><br><br>
            Internet banking allows you to:<br><br>
            ‚Ä¢ <strong>Check balance</strong> and statements<br>
            ‚Ä¢ <strong>Transfer funds</strong> (NEFT/RTGS/IMPS)<br>
            ‚Ä¢ <strong>Pay bills</strong> and recharge<br>
            ‚Ä¢ <strong>Open FDs/RDs</strong> online<br>
            ‚Ä¢ <strong>Request chequebook</strong><br><br>
            Register for net banking at your bank's website.`;
        }
        
        // Interest rates
        else if (lowerMsg.includes('interest rate') || lowerMsg.includes('interest rates')) {
            response = `üìä <strong>Current Interest Rates (Approximate)</strong><br><br>
            ‚Ä¢ <strong>Savings Account:</strong> 2.5% - 4%<br>
            ‚Ä¢ <strong>Fixed Deposit (1 year):</strong> 5.5% - 7%<br>
            ‚Ä¢ <strong>RD:</strong> 5% - 6.5%<br>
            ‚Ä¢ <strong>Home Loan:</strong> 8.5% - 10%<br>
            ‚Ä¢ <strong>Personal Loan:</strong> 10% - 18%<br>
            ‚Ä¢ <strong>Car Loan:</strong> 8% - 12%<br>
            ‚Ä¢ <strong>Education Loan:</strong> 7% - 11%<br><br>
            Rates vary by bank and your credit profile.`;
        }
        
        // Financial planning basics
        else if (lowerMsg.includes('emergency fund')) {
            response = `üõ°Ô∏è <strong>Emergency Fund Guide</strong><br><br>
            ‚Ä¢ <strong>Target:</strong> 3-6 months of expenses<br>
            ‚Ä¢ <strong>For you:</strong> ~‚Çπ1,50,000 recommended<br>
            ‚Ä¢ <strong>Where to keep:</strong> Savings account or liquid fund<br>
            ‚Ä¢ <strong>Monthly contribution:</strong> ‚Çπ10,000 suggested<br>
            ‚Ä¢ <strong>Current progress:</strong> 40% of goal<br><br>
            Build this before investing in markets.`;
        }
        else if (lowerMsg.includes('cibil') || lowerMsg.includes('credit score')) {
            response = `üìä <strong>CIBIL/Credit Score Guide</strong><br><br>
            ‚Ä¢ <strong>Range:</strong> 300-900<br>
            ‚Ä¢ <strong>Excellent:</strong> 750+ (best loan rates)<br>
            ‚Ä¢ <strong>Good:</strong> 700-749<br>
            ‚Ä¢ <strong>Fair:</strong> 650-699<br>
            ‚Ä¢ <strong>Poor:</strong> Below 650<br><br>
            Check free score on: CIBIL, Experian, or bank apps.<br><br>
            Pay bills on time and keep credit utilization below 30%.`;
        }
        
        // Spend/budget/invest/save/goal responses (keep existing)
        else if (lowerMsg.includes('spend') || lowerMsg.includes('expense') || lowerMsg.includes('budget')) {
            response = `üìä <strong>Budget Analysis</strong><br><br>
            Based on your spending patterns:<br>
            ‚Ä¢ <span class="amount">‚Çπ33,250</span> spent of <span class="amount">‚Çπ45,000</span> monthly budget<br>
            ‚Ä¢ <span class="highlight">Food & Dining:</span> ‚Çπ4,500 (within limit)<br>
            ‚Ä¢ <span class="highlight">Entertainment:</span> ‚Çπ1,850 (38% lower)<br>
            ‚Ä¢ <span class="highlight">Shopping:</span> ‚Çπ5,200 (exceeded by ‚Çπ200)<br><br>
            You're on track to save <span class="amount positive">‚Çπ11,750</span> this month.`;
        }
        else if (lowerMsg.includes('invest')) {
            response = `üí° <strong>Investment Recommendation</strong><br><br>
            For your <span class="highlight">‚Çπ50,000</span> investible surplus:<br><br>
            ‚Ä¢ <strong>SIP in Large Cap:</strong> ‚Çπ20,000 (40%)<br>
            ‚Ä¢ <strong>PPF / EPF:</strong> ‚Çπ15,000 (30%) - Tax free<br>
            ‚Ä¢ <strong>Mid Cap Fund:</strong> ‚Çπ10,000 (20%)<br>
            ‚Ä¢ <strong>Liquid Fund:</strong> ‚Çπ5,000 (10%) - Emergency<br><br>
            Expected returns: <span class="amount">10-12%</span> over 3 years`;
        }
        else if (lowerMsg.includes('save') || lowerMsg.includes('saving')) {
            response = `üí∞ <strong>Savings Opportunities</strong><br><br>
            I've analyzed your expenses and found:<br>
            ‚Ä¢ Cut <span class="amount negative">‚Çπ1,200</span> from dining out (20% reduction)<br>
            ‚Ä¢ Optimize <span class="amount positive">‚Çπ850</span> from subscriptions<br>
            ‚Ä¢ Switch to <span class="highlight">auto-save</span> ‚Çπ5,000 monthly<br><br>
            Potential monthly savings: <span class="amount positive">‚Çπ7,050</span>`;
        }
        else if (lowerMsg.includes('goal') || lowerMsg.includes('target')) {
            response = `üéØ <strong>Financial Goals Progress</strong><br><br>
            ‚Ä¢ <strong>Emergency Fund:</strong> ‚Çπ1,20,000 of ‚Çπ3,00,000 (40%)<br>
            ‚Ä¢ <strong>Down Payment:</strong> ‚Çπ4,50,000 of ‚Çπ10,00,000 (45%)<br>
            ‚Ä¢ <strong>Vacation Fund:</strong> ‚Çπ35,000 of ‚Çπ80,000 (44%)<br><br>
            You're on track to meet your emergency fund goal by <span class="highlight">December 2024</span>.`;
        }
        else {
            response = `I understand you're asking about "${lastMessage}". As Vault AI, your financial assistant, I can help with:
            <br><br>
            ‚Ä¢ Budgeting & expenses<br>
            ‚Ä¢ Investment advice<br>
            ‚Ä¢ Savings strategies<br>
            ‚Ä¢ Banking basics (accounts, loans, cards)<br>
            ‚Ä¢ Financial planning<br><br>
            Could you be more specific about what you'd like to know?`;
        }
        
        addAIMessage(response);
    }

    function addAIMessage(text) {
        const now = new Date();
        const timeString = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
        
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message ai';
        messageDiv.innerHTML = `
            <div class="bubble-wrapper">
                <div class="bubble ai">${text}</div>
                <div class="timestamp">${timeString}</div>
            </div>
        `;
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // Show suggestions again after response
        if (suggestions) {
            suggestions.style.display = 'flex';
        }
    }

    // Clear empty state when messages exist
    const emptyState = document.querySelector('.chat-empty');
    if (emptyState) {
        emptyState.remove();
    }

    
</script>

{% endblock %}